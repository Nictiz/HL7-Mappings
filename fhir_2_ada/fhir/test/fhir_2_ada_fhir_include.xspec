<?xml version="1.0" encoding="UTF-8"?>
<x:description xmlns:x="http://www.jenitennison.com/xslt/xspec" xmlns:local="urn:fhir:stu3:functions" stylesheet="../fhir_2_ada_fhir_include.xsl">
    
    <x:scenario label="fhir_2_ada_fhir_include">
        
        <x:scenario label="function code-to-code" pending="">
            <x:call template="code-to-code">
                <x:param name="value" select="'no_value'"/>
                <x:param name="codeMap" select="'no_value'"/>
            </x:call>
            <x:expect label="Not yet implemented"/>
        </x:scenario>
        
        <x:scenario label="function CodeableConcept-to-code">
            <x:scenario label="CodeableConcept with 2 Codings and text">
                <x:call template="CodeableConcept-to-code">
                    <x:param name="in">
                        <code xmlns="http://hl7.org/fhir">
                            <coding>
                                <system value="urn:oid:2.16.840.1.113883.2.4.4.10"/>
                                <code value="17469"/>
                                <display value="IBUPROFEN TABLET 600MG"/>
                                <userSelected value="true"/>
                            </coding>
                            <coding>
                                <system value="urn:oid:2.16.840.1.113883.2.4.4.1"/>
                                <code value="42080"/>
                                <display value="IBUPROFEN TABLET 600MG"/>
                            </coding>
                            <text value="IBUPROFEN TABLET 600MG"/>
                        </code>
                    </x:param>
                    <x:param name="adaElementName" select="'product_code'"/>
                    <x:param name="inElementName" select="'coding'"/>
                </x:call>
                <x:expect label="Not yet implemented">
                    <product_code
                        code="17469"
                        codeSystem="2.16.840.1.113883.2.4.4.10"
                        codeSystemName="G-Standaard PRK"
                        displayName="IBUPROFEN TABLET 600MG"/>
                    <product_code
                        code="42080"
                        codeSystem="2.16.840.1.113883.2.4.4.1"
                        codeSystemName="G-Standaard GPK"
                        displayName="IBUPROFEN TABLET 600MG"/>
                </x:expect>
            </x:scenario>
            <x:scenario label="CodeableConcept with nullFlavor Coding and text">
                <x:call template="CodeableConcept-to-code">
                    <x:param name="in">
                        <code xmlns="http://hl7.org/fhir">
                            <extension url="http://hl7.org/fhir/StructureDefinition/iso21090-nullFlavor">
                                <valueCode value="OTH"/>
                            </extension>
                            <text value="Ureum 10% in eucerine cum aqua 100gr"/>
                        </code>
                    </x:param>
                    <x:param name="adaElementName" select="'product_code'"/>
                </x:call>
                <x:expect label="Return product_code @code='OTH'">
                    <product_code code="OTH" codeSystem="2.16.840.1.113883.5.1008" codeSystemName="HL7 NullFlavor" displayName="overig"/>
                </x:expect>
            </x:scenario>
        </x:scenario>
        
        <x:scenario label="function Coding-to-code" pending="">
            <x:scenario label="nullFlavor Coding">
                <x:call template="Coding-to-code">
                    <x:param name="in" select="'no_value'"/>
                </x:call>
                <x:expect label="Not yet implemented"/>
            </x:scenario>
        </x:scenario>
        
        <x:scenario label="function format2ADADate">
            <!--<x:call template="format2ADADate">
                <x:param name="dateTime" select="'no_value'"/>
                <x:param name="precision" select="'no_value'"/>
                <x:param name="dateT" select="'no_value'"/>
            </x:call>
            <x:expect label="Not yet implemented"/>-->
            <x:scenario label="dateTime = '1954-05-08'">
                <x:call template="format2ADADate">
                    <x:param name="dateTime" select="'1954-05-08'"/>
                </x:call>
                <x:expect label="Return same">1954-05-08</x:expect>
            </x:scenario>
            <x:scenario label="dateTime = '2013-01-14T10:00'">
                <x:call template="format2ADADate">
                    <x:param name="dateTime" select="'2013-01-14T10:00:00+01:00'"/>
                </x:call>
                <x:expect label="Add seconds and Amsterdam time zone">2013-01-14T10:00:00+01:00</x:expect>
            </x:scenario>
            <x:scenario label="dateTime = '2020-06-03T13:12:16.805+00:00'">
                <x:call template="format2ADADate">
                    <x:param name="dateTime" select="'2020-06-03T13:12:16.805+00:00'"/>
                </x:call>
                <x:expect label="Remove milliseconds">2020-06-03T13:12:16+00:00</x:expect>
            </x:scenario>
            <x:scenario label="dateTime = '${{DATE, T, D, -20}}T00:00:00+02:00'">
                <x:call template="format2ADADate">
                    <x:param name="dateTime" select="'${DATE, T, D, -20}T00:00:00+02:00'"/>
                </x:call>
                <x:expect label="Transcribe TouchStone-T to ADA-T">T-20D{00:00:00}</x:expect>
            </x:scenario>
        </x:scenario>
        
        <x:scenario label="function getOid">
            <x:scenario label="uri = 'http://fhir.nl/fhir/NamingSystem/bsn'">
                <x:call function="local:getOid">
                    <x:param name="uri" select="'http://fhir.nl/fhir/NamingSystem/bsn'"/>
                </x:call>
                <x:expect label="Return bsn oid." select="'2.16.840.1.113883.2.4.6.3'"/>
            </x:scenario>
            <x:scenario label="uri = 'urn:oid:2.16.840.1.113883.2.4.3.11.999.77.1.1'">
                <x:call function="local:getOid">
                    <x:param name="uri" select="'urn:oid:2.16.840.1.113883.2.4.3.11.999.77.1.1'"/>
                </x:call>
                <x:expect label="Remove urn:oid:" select="'2.16.840.1.113883.2.4.3.11.999.77.1.1'"/>
            </x:scenario>
        </x:scenario>
        
        <x:scenario label="function getDisplayName">
            <x:scenario label="Valid oid">
                <x:call function="local:getDisplayName">
                    <x:param name="oid" select="'2.16.840.1.113883.2.4.4.10'"/>
                </x:call>
                <x:expect label="Return displayName" select="'G-Standaard PRK'"/>
            </x:scenario>
            <x:scenario label="Oid without displayName mapped">
                <x:call function="local:getDisplayName">
                    <x:param name="oid" select="'test'"/>
                </x:call>
                <x:expect label="Return supplied oid" select="'test'"/>
            </x:scenario>
        </x:scenario>
        
        <!--<x:scenario label="template with match 'comment()" pending="">
            <x:context/>
            <x:expect label="Not yet implemented"/>
        </x:scenario>
        
        <x:scenario label="template with match 'text()" pending="">
            <x:context/>
            <x:expect label="Not yet implemented"/>
        </x:scenario>-->

    </x:scenario>
    
</x:description>
